<!DOCTYPE html>
<html>
<head>
  <title>ACT 1 Film Festival</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <style>
    body { font-family: Arial; background:#111; color:white; }
    h1 { text-align:center; }
    .slot {
      border:1px solid #444;
      padding:15px;
      margin:10px;
      background:#1a1a1a;
    }
    img { max-width:200px; display:block; margin-top:10px; }
    input { margin:3px; }
    button { margin:5px 0; }
  </style>
</head>

<body>

<h1>ACT 1 Film Festival</h1>
<div id="slots"></div>

<script>

const supabaseClient = supabase.createClient(
  "https://qgvgaswagloibanqbfbc.supabase.co",
  "sb_publishable_BSZwz-29LbC2iAJHpTxpBA_MbJQmQS2"
)

async function loadSlots() {
  const { data, error } = await supabaseClient
    .from('films')
    .select('*')
    .order('slot_number')

  if (error) {
    console.error(error)
    return
  }

  const container = document.getElementById('slots')
  container.innerHTML = ''

  data.forEach(slot => {
    const div = document.createElement('div')
    div.className = 'slot'

    div.innerHTML = `
      <h3>Slot ${slot.slot_number}</h3>
      <p><b>Title:</b> ${slot.title ?? 'Empty'}</p>
      <p><b>Genre:</b> ${slot.genre ?? ''}</p>
      <p><b>City:</b> ${slot.city ?? ''}</p>
      ${slot.thumbnail_url ? `<img src="${slot.thumbnail_url}" />` : ''}
      <hr>
      <input type="text" placeholder="Film Title" id="title-${slot.slot_number}">
      <input type="text" placeholder="Genre" id="genre-${slot.slot_number}">
      <input type="text" placeholder="City" id="city-${slot.slot_number}">
      <input type="email" placeholder="Email (private)" id="email-${slot.slot_number}">
      <input type="password" placeholder="Password" id="password-${slot.slot_number}">
      <br>
      <button onclick="updateSlot(${slot.slot_number})">Submit / Update</button>
    `

    container.appendChild(div)
  })
}

async function updateSlot(slotNumber) {

  const title = document.getElementById(`title-${slotNumber}`).value
  const genre = document.getElementById(`genre-${slotNumber}`).value
  const city = document.getElementById(`city-${slotNumber}`).value
  const email = document.getElementById(`email-${slotNumber}`).value
  const password = document.getElementById(`password-${slotNumber}`).value

  await supabaseClient
    .from('films')
    .update({
      title,
      genre,
      city,
      email,
      password
    })
    .eq('slot_number', slotNumber)

  alert("Slot Updated")
  loadSlots()
}

loadSlots()

</script>

</body>
</html>